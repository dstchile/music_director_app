<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Documento sin t√≠tulo</title>
<script src="js/jquery-3.1.1.js"></script>
<link href="css/estilos.css" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="css/fontello.css" type="text/css">
<script>
function getParameterByName(name) 
	{
    name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
    var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
    results = regex.exec(window.ruta_enviada);
    return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
	}
	document.addEventListener("deviceready", recepcion, false);

	function recepcion(){
			var nombre_grupo = getParameterByName('v1');
			document.getElementById('nombre_g').value=nombre_grupo;
			var nombre_grupo = nombre_grupo.toUpperCase();
			document.getElementById('t-can').textContent=nombre_grupo;
		}
	
	$(window).resize(function(){
		//aqui el codigo que se ejecutara cuando se redimencione la ventana
		var alto=$(window).height();
		var ancho=$(window).width();
		if(ancho>alto)
			{
				document.getElementById("list").className="listado_grupo2";
				document.getElementById("list2").className="listado_grupo2";
			}
		else
			{
				document.getElementById("list").className="listado_grupo";
				document.getElementById("list2").className="listado_grupo";
			}
		//alert("alto: "+alto+" ancho:"+ancho);
	})

	document.addEventListener("deviceready", lectura_datos, false);
	function lectura_datos()
		{
			var x=document.getElementById('busqueda').value;
			var db = window.openDatabase("music_director_app", "1.0", "music_director_app", 2000000); //will create database Dummy_DB or open it
			db.transaction(queryDB,errorCB);
			function queryDB(tx)
				{
					var busq = x;
					if(busq!='')
						{
							tx.executeSql('SELECT * FROM director WHERE titulo_cancion LIKE "%'+busq+'%" OR cantante LIKE "%'+busq+'%" OR letra_cancion LIKE "%'+busq+'%"',[],querySuccess,errorCB);
						}
					else
						{
							tx.executeSql('SELECT * FROM director',[],querySuccess,errorCB);
						}
				}
			function errorCB(err) 
				{
				alert("Error processing SQL: "+err.code);
				}
			function querySuccess(tx,result)
				{
				lectura_datos2();
				$('#Listado_canciones').empty();
				for (var i=0; i<result.rows.length; i++) 
					{
					var row = result.rows.item(i);
					var id_cancion=row['id'];
					var mid=memoid[id_cancion];
					var titulo=row['titulo_cancion'];
					var cantante=row['cantante'];
					var velocidad=row['velocidad'];
					var compas=row['compas'];
					var letra_cancion=row['letra_cancion'];
					var tono=row['tono'];
					console.log("id cancion: "+id_cancion+" memo cancion: "+mid)
					if(id_cancion!=mid)
					{
						$('#Listado_canciones').append("<li id='ccan"+id_cancion+"'><a href='#' ontouchstart='espera("+id_cancion+")' onClick='espera("+id_cancion+")' ontouchmove='movimiento()' ontouchcancel='movimiento()' ontouchend='noespera("+id_cancion+")'><p><span class='icon-headphones'> - <font style='font-size:16px; font-weight:bold'>"+row["titulo_cancion"]+"</font></span></p><p><span class='icon-mic'> - "+row["cantante"]+"</span></p><p><span class='icon-music'> - "+row["tono"]+"</span></p></a><input type='hidden' id='can"+id_cancion+"' value='"+titulo+"'></li>");
					}
					memocancion[id_cancion]=titulo;
					memocantante[id_cancion]=cantante;
					memotono[id_cancion]=tono;
					}
				}
		}
		function lectura_datos2()
		{
			var db = window.openDatabase("music_director_app", "1.0", "music_director_app", 2000000); //will create database Dummy_DB or open it
			db.transaction(queryDB,errorCB);
			function queryDB(tx)
				{
					tx.executeSql('SELECT * FROM lista_grupos WHERE id_grupo="" ORDER BY id desc',[],querySuccess,errorCB);
				}
			function errorCB(err) 
				{
				//alert("Error processing SQL: "+err.code);
				}
			function querySuccess(tx,result)
				{
				$('#Listado_canciones2').empty();
				for (var i=0; i<result.rows.length; i++) 
					{
					var row = result.rows.item(i);
					var id=row['id'];
					var id_cancion=row['id_cancion'];
					var id_grupo=row['id_grupo'];
					document.getElementById('ccan'+id_cancion).style.backgroundColor="#c61";
					var mcan=memocancion[id_cancion];
					var mcant=memocantante[id_cancion];
					var mtono=memotono[id_cancion];
 					$('#Listado_canciones2').append("<li><a href='#'><p><span class='icon-headphones'> - <font style='font-size:16px; font-weight:bold'>"+mcan+"</font></span></p><p><span class='icon-mic'> - "+mcant+"</span></p><p><span class='icon-music'> - "+mtono+"</span></p></a><button id='sacar"+id_cancion+"' onClick='eliminar_de("+id_cancion+")'><span class='icon-trash'></span></button></li>");
					memoid[id_cancion]='no';
					}
				}
		}
	var tiempo=false;
	var v_id=0;
	var mover=false;
	function espera(id_c){
		v_id=id_c;
		var tit=document.getElementById('can'+id_c).value;
		tiempo=true;
		mover=false;
		setTimeout(function(){procesar(id_c,tit);clearTimeout();},500)
		
		}
	function procesar(id_c,tit){
		if(tiempo && v_id==id_c && memoid[id_c]!='no')
			{
				document.getElementById('valor_id').value=id_c;
				document.getElementById('ccan'+id_c).style.backgroundColor="#c61";
				document.addEventListener("deviceready", eliminar, false);
			}
		}
		function movimiento(){
			tiempo=false;
			mover=true;
		}
		function noespera(id_c){
			tiempo=false;
			}	
		
		function eliminar(){
			var db = window.openDatabase("music_director_app", "1.0", "music_director_app", 2000000);
			el(db)
		}
		function eliminar_de(id_c){
			
			document.getElementById('valor_id').value=id_c;
			var db = window.openDatabase("music_director_app", "1.0", "music_director_app", 2000000);
			el_de(db)
		}
		
		
		
		
		function el(db){
			db.transaction(queryDB);
			function queryDB(tx)
				{
					var id_c=document.getElementById('valor_id').value;
					tx.executeSql('INSERT INTO lista_grupos (id_grupo,id_cancion)values("","'+id_c+'")');
					lectura_datos2();
					$('#list2').scrollTop(0);
				}
		}
		function el_de(db){
			db.transaction(queryDB);
			function queryDB(tx)
				{
					var id_c=document.getElementById('valor_id').value;
					tx.executeSql('DELETE FROM lista_grupos WHERE id_cancion="'+id_c+'" AND id_grupo=""');
					document.getElementById('ccan'+id_c).style.backgroundColor="#ffffff";
					memoid[id_c]='';
					lectura_datos2();
				}
		}
		function guardar_grupo(){
			var db = window.openDatabase("music_director_app", "1.0", "music_director_app", 2000000);
			db.transaction(queryDB);
			function queryDB(tx)
				{
					tx.executeSql('SELECT * FROM lista_grupos WHERE id_grupo=""',[],insert)
				}
			function insert(tx,result){
					var x=result.rows.length;
					if(x>0)
						{
							var ng=document.getElementById('nombre_g').value;
							tx.executeSql('INSERT INTO grupos (nombre_grupo)VALUES("'+ng+'")',[],insertExito);
						}
					else
						{
							alert("Debe seleccionar al menos una cancion")
						}
				}
			function insertExito(tx,result){
					result.insertId;
					tx.executeSql('UPDATE lista_grupos set id_grupo="'+result.insertId+'" WHERE id_grupo=""',[],updateExito)
				}
			function updateExito(tx,result){
					var ng=document.getElementById('nombre_g').value;
					alert("Grupo "+ng+" guardado con exito");
					hipervinculo("listado_grupos.html");
				}
		}
		
		
var memoid=new Array;
var memocancion=new Array;
var memocantante=new Array;
var memotono=new Array;
</script>
</head>



<body>
<div id="menu-superior">
<a href="grupo_nuevo.html" title="lista" id="boton-back" class="boton2 ancho-back"><span class="icon-left-open"></span></a><a style="width: 90vw" disabled><span id="t-can"></span></a>
</div>
<div class="busqueda"><span class="icon-search"></span><input type="text" name="busqueda" id="busqueda" placeholder="Cancion / Cantante / Grupo / Letra" onKeyUp="lectura_datos();" onBlur="lectura_datos();"></div>
<div id="list" class="listado_grupo">
<ul id="Listado_canciones" class="listado_canciones"></ul>
</div>
<div class="agregados">AGREGADOS</div>
<div id="list2" class="listado_grupo">
<ul id="Listado_canciones2" class="listado_canciones flex"></ul>
</div>
<div id="boton_guardar" class="base_cancion" align="center">
	<input type="button" id="guardar" name="guardar" onClick="guardar_grupo()" value="Guardar">
</div>
<input type="hidden" id="valor_id">
<input type="hidden" id="nombre_g">
</body>
</html>

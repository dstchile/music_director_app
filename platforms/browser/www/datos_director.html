<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no, width=device-width">
 <title>Documento sin título</title>
    <link href="css/estilos.css" rel="stylesheet" type="text/css">
	<link rel="stylesheet" href="css/fontello.css" type="text/css">
	<script src="js/jquery-3.1.1.js"></script>
	<script type="text/javascript" src="js/mensajes.js"></script>
	<script>
	document.addEventListener("deviceready", lectura_inicial, false);
		function lectura_inicial()
			{
				lectura_datos();
				console.log("carga de BD");
			}
		function lectura_datos(db)
			{
			var db = window.openDatabase("music_director_app", "1.0", "music_director_app", 2000000); //will create database Dummy_DB or open it
			db.transaction(queryDB,errorCB);
			function queryDB(tx)
				{
				tx.executeSql('SELECT * FROM datos_director ',[],querySuccess,errorCB);
				console.log( "Leyendo datos guardados." );
				}
				function errorCB(err) 
				{
				if (err.code!=0)
					{
					alert("1Error processing SQL: "+err.code);
					}
				}
				function querySuccess(tx,result)
				{
				
				console.log( "generando query." );
				var existen_datos=false;
				/*
				//////este codigo falla en android 5.0
				$.each(result.rows,function(index)
					{
					var existen_datos=true;
					var row = result.rows.item(index);
					document.getElementById('nombre_director').value=row['nombre_usuario'];
					document.getElementById('correo_electronico').value=row['correo_electronico'];
					document.getElementById('memoid').value=row['id'];
					
					});*/
				for (var i=0; i<result.rows.length; i++) 
			   		{
					var row = result.rows.item(i);
				  	document.getElementById('nombre_director').value=row['nombre_usuario'];
					document.getElementById('correo_electronico').value=row['correo_electronico'];
					document.getElementById('memoid').value=row['id'];
					}
				$('#superior').empty();
				if (result.rows.length>=1)
					{
					console.log("con datos");
					$('#superior').html('<a onClick=hipervinculo("vista_director.html") id="retorno" class="boton2 ancho-back"><span class="icon-left-open"></span></a><a href="#" class="boton2_activo ancho-b_listado"><span class="icon-user"></span></a><a href="#" class="boton2 ancho-b_grupos"><span class="icon-text-height"></span></a><a href="#" class="boton2 ancho-b_agregar"><span class="icon-download-cloud"></span></a><a href="#" class="boton2 ancho-b_config"><span class="icon-floppy"></span></a>');
					//var ruta="listado.html";
					//document.getElementById("retorno").href = ruta;
					}
				else
					{
					console.log("sin datos");
					$('#superior').html('<a onClick=hipervinculo("index.html") id="retorno" class="boton2 ancho-back"><span class="icon-left-open"></span></a><a href="#" class="boton2" style="width:90vw"><span class="icon-user"> Nuevo Director</span></a>');
					//var ruta="index.html";
					//document.getElementById("retorno").href = ruta;
					}
				
				}
			}        
        
function guardar_datos(){
	var nombre_director = document.getElementById('nombre_director').value;
	var correo_electronico = document.getElementById('correo_electronico').value;
	var memoid = document.getElementById('memoid').value;
	
	var nombre_directorv = nombre_director.replace(/'/g,"''");
	var correo_electronicov = correo_electronico.replace(/'/g,"''");
	
	if(nombre_director=='')
		{
		mensaje_texto("Debe especificar el nombre del Director");	
		}
	else if(correo_electronico=='')
		{
			mensaje_texto("Debe especificar un correo electrónico");	
		}
	else
		{
		var db = window.openDatabase("music_director_app", "1.0", "music_director_app", 2000000); //will create database Dummy_DB or open it
		db.transaction(populateDB, errorCB, successCB);
		function populateDB(tx) 
			{
			if (memoid!='')
				{
				tx.executeSql("UPDATE datos_director set nombre_usuario='"+nombre_directorv+"' , correo_electronico='"+correo_electronicov+"' where id='"+memoid+"'");
				}
			else
				{
				tx.executeSql("INSERT INTO datos_director (nombre_usuario,correo_electronico)VALUES('"+nombre_directorv+"','"+correo_electronicov+"')");														
				}
			}
		function errorCB(err) 
			{
			alert("Error processing 2 SQL: "+err.code);
			}
		function successCB() 
			{
			mensaje_texto('Datos guardados correctamente!');	
				if (memoid=='')
					{
					location.href="listado_director.html";
					}
			}
		}
	}


	</script>
</head>
<body style="background-color:#666;">
<!--<div id="superior" style="min-height:20px; height:52px"></div>-->
<div class="titulo_cancion">
	<font color="white">Nombre Director(use un nickname sencillo)</font>
</div>
<div class="titulo_cancion centrado">
	<input type="text" id="nombre_director" name="nombre_director" class="entrada_texto" >
</div>
<div class="parrafo">
El nombre de Director es usado por la Aplicación para conectarse con los músicos, es recomendable usar un nombre facil de identificar por tus músicos para que puedan sincronizar facilmente.
</div>
<div style="background-color:#666; height:40px"></div>
<div class="titulo_cancion">
	<font color="white">Correo Electrónico</font>
</div>
<div class="titulo_cancion centrado">
	<input type="text" id="correo_electronico" name="correo_electronico" class="entrada_texto" >
</div>
<div class="parrafo">
El número de teléfono es usado por la Aplicación para descargar las canciones creadas desde la página web, te ayudará a ahorrar tiempo en la creación de canciones, de esta manera será mucho más rápido subir tus canciones a la aplicación.
</div>
<!--<div style="background-color:#666; height:100px"></div>-->
	<input type="button" id="guardar" name="guardar" onClick="guardar_datos()" value="Guardar">	
<!--<div id="boton_guardar" class="base_cancion" align="center">
</div>-->
<input name="memoid" id="memoid" type="hidden">
</body>
</html>
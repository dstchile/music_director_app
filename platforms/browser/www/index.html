<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no, width=device-width">
        <title>Blank App</title>
    <script src="js/jquery-3.3.1.min.js"></script>
	<link href="css/estilos.css" rel="stylesheet" type="text/css">
    <script type="text/javascript" src="cordova.js"></script>
    </head>
    <body>
    <div class="content">
		<div class="content-menu">
			<ul>
				<li><a href="" id="director" class="boton1">DIRECTOR</a></li>
				<li><a href="busca_director.html" title="lista" class="boton1">MÚSICO</a></li>
			</ul>
	<a href="servidor.html" style="color:#FFF" >SERVIDOR</a>
	<a href="cliente.html" >CLIENTE</a>
	<a href="cancion_detalle_musico.html" >musico</a>
	<a href="#" onClick="borrar_director()">borrar directos</a>
		</div>
	</div>
    </body>
     <script>
	 	 
     $(document).ready(function() 
		{
	   
		document.addEventListener("deviceready", lectura_inicial, false);
		function lectura_inicial()
			{
			/////////////comporbación de permisos////////////////
			var permissions = cordova.plugins.permissions;
			permissions.checkPermission(permissions.ACCESS_NETWORK_STATE, function(status) 
				{
				  if (status.checkPermission) 
					{
					// here you can savely start your own plugin because you already have CAMERA permission
					}
				  else 
					{
					// need to request camera permission
					permissions.requestPermission(permissions.ACCESS_NETWORK_STATE, success, error);
					function error() 
						{
						alert("Hubo un error , intente habilitar el permiso manualmente en las configuraciones del teléfono")
					  // camera permission not turned on
						}
				
					function success(status) 
						{
						if (status.checkPermission) 
							{
						// user accepted, here you can start your own plugin
							}
						}
					}
				});
			permissions.checkPermission(permissions.INTERNET, function(status) 
				{
				  if (status.checkPermission) 
					{
					// here you can savely start your own plugin because you already have CAMERA permission
					}
				  else 
					{
					// need to request camera permission
					permissions.requestPermission(permissions.INTERNET, success, error);
					function error() 
						{
						alert("Hubo un error , intente habilitar el permiso manualmente en las configuraciones del teléfono")
					  // camera permission not turned on
						}
				
					function success(status) 
						{
						if (status.checkPermission) 
							{
						// user accepted, here you can start your own plugin
							}
						}
					}
				});	
			permissions.checkPermission(permissions.READ_PHONE_STATE, function(status) 
				{
				  if (status.checkPermission) 
					{
					// here you can savely start your own plugin because you already have CAMERA permission
					}
				  else 
					{
					// need to request camera permission
					permissions.requestPermission(permissions.READ_PHONE_STATE, success, error);
					function error() 
						{
						alert("Hubo un error , intente habilitar el permiso manualmente en las configuraciones del teléfono")
					  // camera permission not turned on
						}
				
					function success(status) 
						{
						if (status.checkPermission) 
							{
						// user accepted, here you can start your own plugin
							}
						}
					}
				});	
			permissions.checkPermission(permissions.ACCESS_WIFI_STATE, function(status) 
				{
				  if (status.checkPermission) 
					{
					// here you can savely start your own plugin because you already have CAMERA permission
					}
				  else 
					{
					// need to request camera permission
					permissions.requestPermission(permissions.ACCESS_WIFI_STATE, success, error);
					function error() 
						{
						alert("Hubo un error , intente habilitar el permiso manualmente en las configuraciones del teléfono")
					  // camera permission not turned on
						}
				
					function success(status) 
						{
						if (status.checkPermission) 
							{
						// user accepted, here you can start your own plugin
							}
						}
					}
				});	
			
		/////////////comporbación de permisos////////////////
		

				try
					{
						window.plugins.insomnia.allowSleepAgain();
					}
				catch(err)
					{
					}
				lectura_datos();
				console.log("carga de BD");
			}
		function lectura_datos(db)
			{
			var db = window.openDatabase("music_director_app", "1.0", "music_director_app", 2000000); //will create database Dummy_DB or open it
			db.transaction(queryDB,errorCB);
			function queryDB(tx)
				{
				tx.executeSql('CREATE TABLE IF NOT EXISTS director (id INTEGER PRIMARY KEY AUTOINCREMENT, titulo_cancion TEXT NOT NULL, cantante TEXT NOT NULL, velocidad INTEGER NOT NULL, tono TEXT NOT NULL, compas TEXT NOT NULL, letra_cancion TEXT NOT NULL)');
				tx.executeSql('CREATE TABLE IF NOT EXISTS datos_director (id INTEGER PRIMARY KEY AUTOINCREMENT, nombre_usuario TEXT NOT NULL, correo_electronico TEXT NOT NULL)');
				tx.executeSql('CREATE TABLE IF NOT EXISTS grupos (id INTEGER PRIMARY KEY AUTOINCREMENT, nombre_grupo TEXT NOT NULL)')
				tx.executeSql('CREATE TABLE IF NOT EXISTS lista_grupos (id INTEGER PRIMARY KEY AUTOINCREMENT, id_grupo INTEGER NOT NULL, id_cancion INTEGER NOT NULL)')
				tx.executeSql('SELECT * FROM datos_director ',[],querySuccess,errorCB);
				console.log( "Leyendo datos guardados." );
				}
				function errorCB(err) 
				{
				if (err.code!=0)
					{
					alert("1Error processing SQL: "+err.code);
					}
				}
				function querySuccess(tx,result)
				{
				
				console.log( "generando query." );
				var existen_datos=false;
				for (var i=0; i<result.rows.length; i++) 
			   		{
					var row = result.rows.item(i);
				  	}
				console.log("regisotr:"+result.rows.length);
				if (result.rows.length>=1)
					{
					console.log("con datos director");
					var ruta="vista_servidor.html";
					document.getElementById("director").href = ruta;
					}
				else
					{
					console.log("sin datos director");
					var ruta="datos_director.html";
					document.getElementById("director").href = ruta;
					}
					
				
				}
			}        
		});
	    
        
        function borrar_director()
			{
			var db = window.openDatabase("music_director_app", "1.0", "music_director_app", 2000000); //will create database Dummy_DB or open it
			db.transaction(populateDB, errorCB, successCB);
			function populateDB(tx) 
				{
				tx.executeSql("DROP TABLE datos_director ");
				//tx.executeSql("DELETE from datos_director where id='1'");
				}
			function errorCB(err) 
				{
				alert("Error processing 2 SQL: "+err.code);
				}
			function successCB() 
				{
				console.log("borrado")
				}
			}        
		
        </script>
   
</html>
